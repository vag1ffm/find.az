{% extends 'homepage/layout.html' %}
{% load static %}

{% block ogmeta %}
    <meta name="description" content="FindAz - cамый лучший интернет магазин в Азербайджане, в котором есть всё! Вы можете найти любой товар который вам нужен и узнать о нём все что нужно, чтобы сходить в магазин и купить его или же заказть его через нас">
    <meta name="Keywords" content="FindAz, Интернет магазин, FindAz - cамый лучший интернет магазин в котором есть всё!, категори, каталоги">
    <meta property="og:title" content="FindAz - лучший интернет магазин в Азербайджане">
    <meta property="og:image" content="<img class='redactor-autoparser-object'=''='' src='{% static 'homepage/img/icon-of-site.webp' %}' >'='">
    <meta property="og:url" content="https://findaz.pythonanywhere.com/">
    <meta property="og:description" content="FindAz - cамый лучший интернет магазин в Азербайджане, в котором есть всё! Вы можете найти любой товар который вам нужен и узнать о нём все что нужно, чтобы сходить в магазин и купить его или же заказть его через нас">
{% endblock ogmeta %}

{% block title %}{{ title }}{% endblock title %}

{% block content %}
    <div class="preloader">
		<div class="loading-spinner"></div>
	</div>

	<div class="slayder">
		<img src="{% static 'homepage/img/reklama1.jpg' %}" alt="">
	</div>

	<div class="content">

		<main>

			<div class="razdel-razdela">
				<h2>Компьютеры и комплектующие AMD</h2>
				<div class="razdel-razdel-tovari">
					<div class="razdel-razdel-tovar">
						<a href="">
							<h4 class="razdel-razdel-name">Процессоры</h4>
						</a>
					</div>
					<div class="razdel-razdel-tovar">
						<a href="">
							<h4 class="razdel-razdel-name">Видеокарты</h4>
						</a>
					</div>
					<div class="razdel-razdel-tovar">
						<a href="">
							<h4 class="razdel-razdel-name">Ноутбуки</h4>
						</a>
					</div>
					<div class="razdel-razdel-tovar">
						<a href="">
							<h4 class="razdel-razdel-name">Настольные Компьютеры</h4>
						</a>
					</div>
					<div class="razdel-razdel-tovar">
						<a href="">
							<h4 class="razdel-razdel-name">Модули памяти</h4>
						</a>
					</div>
					<div class="razdel-razdel-tovar">
						<a href="">
							<h4 class="razdel-razdel-name">Внутренние твердотельные</h4>
						</a>
					</div>
				</div>
			</div>

			{% for pc in podcats %}
			<div class="complekt-tovarov">
				<h1>{{ pc.0.podpodcat }}</h1>
				<div class="tovari">
                    {% for tovar in pc %}
					<div class="qlavniy-tovar">

                        {% if forloop.last and not forloop.first %}
                            <div class="space">
                                <a href="{{ tovar.podpodcat.get_absolute_url }}">
                                    <div>Ещё</div>
                                    <div><i class="fas fa-angle-right"></i></div>
                                </a>
                            </div>
                        {% endif %}

						<div class="izbranniy-tovar">
                            {% if request.user.is_authenticated %}
                                    <label for="{{ tovar.pk }}" class="{% if tovar in fav_tovari %}red{% endif %}">
                                        <i class="fa-solid fa-heart {{ tovar.pk }}"></i>
                                    </label>
                                    <input name="favorite" style="display: none" class='heart' type="checkbox" id="{{ tovar.pk }}">
                            {% else %}
{#                                                <a href="{% url 'login' %}">#}
                                    <i class="fa-solid fa-heart"></i>
{#                                                </a>#}
                            {% endif %}
                        </div>

						<a href="{{ tovar.get_absolute_url }}">
							<div class="qlavniy-tovar-img"><img src="{{ tovar.photo_main.url }}" alt=""></div>
							<span class="tovar-info">
                                <div class="chena">{{ tovar.price }} ₼</div>
                                <div class="reyting">
                                    <div class="zvezda">звезды</div>
                                    <div class="chislo-ochenik">50</div>
                                </div>
                                <div class="tovar-name">{{ tovar.title|truncatewords:10 }}</div>
                                <div class="rekomenduyemost">86% рекомендуют</div>
						    </span>

						</a>
						<div class="button"><button>В корзину</button></div>
					</div>
                    {% endfor %}
				</div>
			</div>
            {% endfor %}

		</main>

		<div class="reklami">
			<div class="reklama">
				<img src="https://avatars.mds.yandex.net/get-adfox-content/2765366/220415_market_1878578_5195915_1.b4846eb40d021e44e9306f4dcef4d9b4.jpg/optimize.webp" alt="">
			</div>
			<div class="reklama">
				<img src="https://avatars.mds.yandex.net/get-adfox-content/2367573/220415_market_1878627_5196067_1.c082788be90caac8388026c23bcf713b.jpg/optimize.webp" alt="">
			</div>
		</div>
    </div>

{% endblock content %}

{% block js %}
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>

        const dpoiskoviki = document.querySelector('.desktop-header .poisk-tovarov')
		const dplaceOfVariants = document.querySelector('.desktop-header .varianti-poiska')
		dpoiskoviki.addEventListener('input', ()=> {
			mpoiskoviki.value = dpoiskoviki.value
			dpoiskoviki.value = mpoiskoviki.value
                if (dpoiskoviki.value === '') {
						dplaceOfVariants.style.display = 'none'
                } else {
                    $(document).ready(function () {
							dplaceOfVariants.style.display = 'block'
						let variantOfSearches = document.querySelectorAll('.desktop-header .variant-poiska')
						variantOfSearches.forEach(variantOfSearch => {
							variantOfSearch.style.display = 'none'
						})
						let searchWord = dpoiskoviki.value
						console.log(searchWord)
						let maindiv = document.createElement('div')
						let a = document.createElement('a')
						maindiv.classList.add('variant-poiska')
						a.innerText = searchWord
						a.href = `/find/?name=${searchWord}`
						maindiv.append(a)
						dplaceOfVariants.append(maindiv)

                        $.ajax({
                            data: { 'value': searchWord },
                            url: "{% url 'find_tovari' %}",
                            success: function (response) {
									for (let i of response.list_title) {
										let div = document.createElement('div')
										div.classList.add('variant-poiska')
										let a = document.createElement('a')
										a.innerText = i
										a.href = `/find/?name=${i}`
										div.append(a)
										dplaceOfVariants.append(div)
										console.log(response)
									}
                            },
                            error: function (response) {
                                console.log(response.responseJSON.errors)
                            }
                        }).then(()=>{
							let variants = document.querySelectorAll('.desktop-header .variant-poiska')
							variants.forEach(variant => {
								variant.addEventListener('click', (event)=>{
									dpoiskoviki.value = event.target.innerText
								})
							})
						})
                        return false;
                    })
                }
            })

		function find(i) {
			let a = i.parentElement.querySelector('input').value
			document.location.href = `/find/?name=${a}`;
		}
		dpoiskoviki.addEventListener('keydown', (e)=> {
			if (e.keyCode === 13) {
				let searchWord = dpoiskoviki.value
				document.location.href = `/find/?name=${searchWord}`;
			}
		})
		const mpoiskoviki = document.querySelector('.mobile-header .poisk-tovarov')
		const mplaceOfVariants = document.querySelector('.mobile-header .varianti-poiska')
		mpoiskoviki.addEventListener('input', ()=> {
			dpoiskoviki.value = mpoiskoviki.value
			mpoiskoviki.value = dpoiskoviki.value
			if (mpoiskoviki.value === '') {
				mplaceOfVariants.style.display = 'none'
			} else {
				$(document).ready(function () {
					mplaceOfVariants.style.display = 'block'
					let variantOfSearches = document.querySelectorAll('.mobile-header .variant-poiska')
					variantOfSearches.forEach(variantOfSearch => {
						variantOfSearch.style.display = 'none'
					})
					let searchWord = mpoiskoviki.value
					console.log(searchWord)
					let maindiv = document.createElement('div')
					let a = document.createElement('a')
					maindiv.classList.add('variant-poiska')
					a.innerText = searchWord
					a.href = `/find/?name=${searchWord}`
					maindiv.append(a)
					mplaceOfVariants.append(maindiv)

					$.ajax({
						data: { 'value': searchWord },
						url: "{% url 'find_tovari' %}",
						success: function (response) {
							for (let i of response.list_title) {
								let div = document.createElement('div')
								div.classList.add('variant-poiska')
								let a = document.createElement('a')
								a.innerText = i
								a.href = `/find/?name=${i}`
								div.append(a)
								mplaceOfVariants.append(div)
								console.log(response)
							}
						},
						error: function (response) {
							console.log(response.responseJSON.errors)
						}
					}).then(()=>{
						let variants = document.querySelectorAll('.mobile-header .variant-poiska')
						variants.forEach(variant => {
							variant.addEventListener('click', (event)=>{
								mpoiskoviki.value = event.target.innerText
							})
						})
					})
					return false;
				})
			}
		})

		function find(i) {
			let a = i.parentElement.querySelector('input').value
			document.location.href = `/find/?name=${a}`;
		}
		mpoiskoviki.addEventListener('keydown', (e)=> {
			if (e.keyCode === 13) {
				let searchWord = mpoiskoviki.value
				document.location.href = `/find/?name=${searchWord}`;
			}
		})










		let chekboxik = document.querySelectorAll('.heart')
		chekboxik.forEach(chekbox => {
			chekbox.addEventListener('click', (event)=>{
				$(document).ready(function () {
					// отслеживаем событие отправки формы

						// создаем AJAX-вызов
					{#console.log(event.target.id)#}
						$.ajax({
							data: {
                                "favorite": event.target.id,
                            }, // получаяем данные формы
							url: "{% url 'crud_favorites' %}",
							// если успешно, то
							success: function (response) {
                                let a = event.target.parentElement.querySelector("label")

								if (response.is_favorite) {
                                    a.classList.add("red")
								}
								else {
									a.classList.remove("red")
								}
							},
							// если ошибка, то
							error: function (response) {
								// предупредим об ошибке
								console.log(response.responseJSON.errors)
							}
						});
						return false;

				})
			})
		})

    </script>
{% endblock js %}
