{% extends 'homepage/layout.html' %}
{% load static %}

{% block title %}{{ title }}{% endblock title %}

{% block content %}

	<div class="slayder">
		<img src="{% static 'homepage/img/reklama1.jpg' %}" alt="">
	</div>
	<div class="content">
		<main>
			<div class="razdel-razdela">
				<h2>Компьютеры и комплектующие AMD</h2>
				<div class="razdel-razdel-tovari">
					<div class="razdel-razdel-tovar">
						<a href="">
							<div class="img">
								<img src="{% static 'homepage/img/prochesor.webp' %}" alt="">
							</div>
							<h4 class="razdel-razdel-name">Процессоры</h4>
						</a>
					</div>
					<div class="razdel-razdel-tovar">
						<a href="">
							<div class="img">
								<img src="{% static 'homepage/img/videocart.webp' %}" alt="">
							</div>
							<h4 class="razdel-razdel-name">Видеокарты</h4>
						</a>
					</div>
					<div class="razdel-razdel-tovar">
						<a href="">
							<div class="img">
								<img src="{% static 'homepage/img/noutbuki.webp' %}" alt="">
							</div>
							<h4 class="razdel-razdel-name">Ноутбуки</h4>
						</a>
					</div>
					<div class="razdel-razdel-tovar">
						<a href="">
							<div class="img">
								<img src="{% static 'homepage/img/pc.webp' %}" alt="">
							</div>
							<h4 class="razdel-razdel-name">Настольные Компьютеры</h4>
						</a>
					</div>
					<div class="razdel-razdel-tovar">
						<a href="">
							<div class="img">
								<img src="{% static 'homepage/img/pamyat.webp' %}" alt="">
							</div>
							<h4 class="razdel-razdel-name">Модули памяти</h4>
						</a>
					</div>
					<div class="razdel-razdel-tovar">
						<a href="">
							<div class="img">
								<img src="{% static 'homepage/img/ssd.webp' %}" alt="">
							</div>
							<h4 class="razdel-razdel-name">Внутренние твердотельные</h4>
						</a>
					</div>
				</div>
			</div>

			{% for c in categorii %}

				<div class="qlavniye-tovari">
					<div class="name-razdela-tovarov"><p>{{ c.0.cat }}</p> <p><a href="{{ c.0.cat.get_absolute_url }}">Еще товары</a></p></div>
					<div class="ryad-tovarov">

						<button id="btnMoveRight" class="p-slayder-tovarov"><i class="fas fa-angle-left"></i></button>

						<div class="slayd-tovarov">
							<div class="slayd">

								{% for tovar in c %}

									<div class="qlavniy-tovar">

                                        <div class="izbranniy-tovar">
                                            <label for="{{ tovar.pk }}">
												<i class="fa-solid fa-heart {{ tovar.pk }}"></i>
											</label>
											<input name="favorite" style="display: none" class='heart' type="checkbox" id="{{ tovar.pk }}">
                                        </div>

                                        <a href="{{ tovar.get_absolute_url }}">
										<div class="qlavniy-tovar-img"><img src="{{ tovar.photo_main.url }}" alt=""></div>
										<div class="chena">{{ tovar.price }} ₼</div>
										<div class="reyting">
											<div class="zvezda">звезды</div>
											<div class="chislo-ochenik">50</div>
										</div>
										<div class="tovar-name">{{ tovar.title|truncatewords:10 }}</div>
										<div class="rekomenduyemost">86% рекомендуют</div>
									</a>
									<div class="button"><button>В корзину</button></div>

								</div>

								{% endfor %}

							</div>
						</div>

						<button id="btnMoveLeft" class="v-slayder-tovarov"><i class="fas fa-angle-right"></i></button>

					</div>
				</div>

			{% endfor %}

		</main>

		<div class="reklami">
			<div class="reklama">
				<img src="https://avatars.mds.yandex.net/get-adfox-content/2765366/220415_market_1878578_5195915_1.b4846eb40d021e44e9306f4dcef4d9b4.jpg/optimize.webp" alt="">
			</div>
			<div class="reklama">
				<img src="https://avatars.mds.yandex.net/get-adfox-content/2367573/220415_market_1878627_5196067_1.c082788be90caac8388026c23bcf713b.jpg/optimize.webp" alt="">
			</div>
		</div>
	</div>

{% endblock content %}

{% block js %}
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>
		let chekboxik = document.querySelectorAll('.heart')
		chekboxik.forEach(chekbox => {
			chekbox.addEventListener('click', (event)=>{
				$(document).ready(function () {
					// отслеживаем событие отправки формы

						// создаем AJAX-вызов
					{#console.log(event.target.id)#}
						$.ajax({
							data: {
                                "favorite": event.target.id,
                            }, // получаяем данные формы
							url: "{% url 'crud_favorites' %}",
							// если успешно, то
							success: function (response) {
                                console.log(response)
								let email= document.getElementById('id_email')
								let a = document.getElementById('error-of-email')

								if (response.is_email === true && id_email.value.length) {
									$('#id_email').removeClass('is-valid').addClass('is-invalid');
									email.style.border = '2px red solid'
									$('#emailError').remove();
									$('#error-of-email').append('<div class="invalid-feedback d-block" id="emailError">This email is not available!</div>')
								}
								else {
									$('#id_username').removeClass('is-invalid').addClass('is-valid');
									$('#emailError').remove();


									if (email.value.length===0) {
										a.innerHTML = ' '
									}else if (email.value.indexOf('@')===-1) {
										a.innerHTML = '<div class="invalid-feedback d-block" id="usernameError">This email is no email!</div>'
										email.style.border = '2px red solid'
									} else {
										a.innerHTML = ' '
										email.style.border ='2px green solid'
									}
								}

							},
							// если ошибка, то
							error: function (response) {
								// предупредим об ошибке
								console.log(response.responseJSON.errors)
							}
						});
						return false;

				})
			})
		})

    </script>
{% endblock js %}
